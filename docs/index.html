<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Memoria de titulaci√≥n</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css"/>
  <style>
    body {
      font-family: sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      padding: 20px;
    }
    :root {
      --bg-color: white;
      --text-color: black;
      --btn-bg: #e0e0e0;
      --btn-text: black;
      --link-color: blue;
    }
    body.dark-mode {
      --bg-color: #121212;
      --text-color: #f0f0f0;
      --btn-bg: #444;
      --btn-text: #f0f0f0;
    }
    a { color: var(--link-color); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .dark-mode a { color: #66ccff; }

    /* Controles */
    .controls { margin-bottom: 20px; display: flex; align-items: center; }
    .lang-dropdown { position: relative; margin-right: 10px; }
    #lang-toggle {
      padding: 8px 12px;
      background-color: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #lang-toggle:hover { opacity: 0.8; }
    #lang-menu {
      list-style: none;
      margin: 4px 0 0;
      padding: 0;
      position: absolute;
      background: var(--bg-color);
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 100;
    }
    #lang-menu li {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #lang-menu li:hover { background: #f0f0f0; }

    /* Flags sizing */
    .fi {
      width: 1.5em;
      height: 1em;
      line-height: 1;
      vertical-align: middle;
      flex-shrink: 0;
    }
    button#dark-toggle {
      padding: 8px 12px;
      background-color: var(--btn-bg);
      color: var(--btn-text);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    button#dark-toggle:hover { opacity: 0.8; }
  </style>
</head>

<body>
  <div class="controls">
    <div class="lang-dropdown">
      <button id="lang-toggle"><span id="current-flag" class="fi"></span><span id="current-label"></span> ‚ñº</button>
      <ul id="lang-menu"></ul>
    </div>
    <button id="dark-toggle"></button>
  </div>

  <h1 data-i18n="title"></h1>
  <h2 data-i18n="subtitle"></h2>
  <h3>Julio Eduardo L√≥pez Blanche</h3>

  <h2 data-i18n="abstractTitle"></h2>
  <p data-i18n="abstract1"></p>
  <p data-i18n="abstract2"></p>
  <p data-i18n="abstract3"></p>

  <h2 data-i18n="linksTitle"></h2>
  <p><a data-i18n-link="pdf" href="main.pdf"></a></p>
  <p><a data-i18n-link="code" href="https://github.com/juliopchile/memoria"></a></p>
  <p><a data-i18n-link="latex" href="https://github.com/juliopchile/memoria-informe"></a></p>

  <script>
    const translations = {
      es: {
        label: 'Espa√±ol', flag: 'fi-es',
        title: 'Segmentaci√≥n de instancias y seguimiento basado en detecci√≥n para caracterizaci√≥n de biomasa y salud en la salmonicultura.',
        subtitle: 'Memoria para optar al t√≠tulo de Ingeniero Civil Electr√≥nico, Menci√≥n en Computadores y Sub-Menci√≥n en Telecomunicaciones.',
        abstractTitle: 'Abstract',
        abstract1: 'En la industria pisc√≠cola, el monitoreo constante de la salud de los peces es crucial. Gracias a los avances en visi√≥n por computadora es posible realizar esta labor de forma escalable y menos invasiva. WildSense, empresa spin-off de la UTFSM, provee servicios para la estimaci√≥n de masa en salmones, donde la segmentaci√≥n de instancias y seguimiento basado en detecci√≥n son parte fundamental de su pipeline, pero a√∫n presenta oportunidades de optimizaci√≥n.',
        abstract2: 'Este proyecto perfecciona una base de datos de segmentaci√≥n de instancias de salmones, al depurarla para incluir √∫nicamente casos de inter√©s, lo que permite entrenar modelos YOLO con rendimientos superiores a trabajos previos. Se optimizan los hiperpar√°metros durante el entrenamiento y se exportan los modelos a TensorRT para reducir los tiempos de inferencia.',
        abstract3: 'Los resultados demuestran que una base de datos m√°s precisa mejora la calidad de los modelos, la optimizaci√≥n de hiperpar√°metros produce mejores resultados y la conversi√≥n a TensorRT reduce significativamente los tiempos de inferencia, con m√≠nima p√©rdida de desempe√±o.',
        linksTitle: 'Links', pdf: 'Leer PDF', code: 'C√≥digo del proyecto', latex: 'C√≥digo LaTeX',
        darkModeOn: 'üåì Modo oscuro', darkModeOff: '‚òÄÔ∏è Modo claro'
      },
      en: {
        label: 'English', flag: 'fi-gb',
        title: 'Instance segmentation and tracking by detection for biomass and health characterization in aquaculture of salmonids.',
        subtitle: 'Final Project Report for the Electronic Civil Engineering degree with Minor in Computers and Secondary Minor in Telecommunications.',
        abstractTitle: 'Abstract',
        abstract1: 'In the aquaculture industry, the constant monitoring of fish health is crucial. Advances in computer vision now allow this task to be performed in a scalable and less invasive manner. WildSense, a spin-off company of the UTFSM, provides services for weight estimation in salmon, for which instance segmentation and detection-based tracking are integral components of its pipeline, although there remains room for optimization.',
        abstract2: 'This project refines an instance segmentation database for salmon by filtering it to include only relevant cases, thereby enabling the training of YOLO models with performance superior to previous works. Hyperparameters are optimized during training, and the models are exported to TensorRT in order to reduce inference times.',
        abstract3: 'The results demonstrate that a more precise database enhances the quality of the models, hyperparameter optimization yields better outcomes, and the conversion to TensorRT significantly reduces inference times with minimal performance loss.',
        linksTitle: 'Links', pdf: 'Read PDF', code: 'Project code', latex: 'LaTeX source',
        darkModeOn: 'üåì Dark mode', darkModeOff: '‚òÄÔ∏è Light mode'
      }
    };
    const supportedLangs = Object.keys(translations);
    const langToggle = document.getElementById('lang-toggle');
    const langMenu = document.getElementById('lang-menu');
    const currentFlag = document.getElementById('current-flag');
    const currentLabel = document.getElementById('current-label');
    const darkToggle = document.getElementById('dark-toggle');

    function buildLangMenu() {
      langMenu.innerHTML = '';
      supportedLangs.forEach(lang => {
        const meta = translations[lang];
        const li = document.createElement('li');
        li.dataset.lang = lang;
        li.innerHTML = `<span class="fi ${meta.flag}"></span>${meta.label}`;
        li.addEventListener('click', () => { setLanguage(lang); toggleLangMenu(false); });
        langMenu.appendChild(li);
      });
    }

    function toggleLangMenu(show) {
      langMenu.style.display = show ? 'block' : 'none';
    }

    langToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleLangMenu(langMenu.style.display !== 'block');
    });
    document.addEventListener('click', () => toggleLangMenu(false));

    function setLanguage(lang) {
      localStorage.setItem('lang', lang);
      applyLanguage(lang);
    }

    function applyLanguage(lang) {
      const tx = translations[lang] || translations.es;
      document.documentElement.lang = lang;
      currentFlag.className = `fi ${tx.flag}`;
      currentLabel.textContent = tx.label;
      document.querySelectorAll('[data-i18n]').forEach(el => el.textContent = tx[el.getAttribute('data-i18n')] || '');
      document.querySelectorAll('[data-i18n-link]').forEach(el => el.textContent = tx[el.getAttribute('data-i18n-link')] || '');
      updateDarkToggleText(lang);
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
      updateDarkToggleText(localStorage.getItem('lang') || 'es');
    }

    function updateDarkToggleText(lang) {
      const tx = translations[lang] || translations.es;
      const key = document.body.classList.contains('dark-mode') ? 'darkModeOff' : 'darkModeOn';
      darkToggle.textContent = tx[key];
    }

    window.addEventListener('DOMContentLoaded', () => {
      buildLangMenu();
      if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
      setLanguage(localStorage.getItem('lang') || 'es');
      darkToggle.addEventListener('click', toggleDarkMode);
    });
  </script>
</body>
</html>
